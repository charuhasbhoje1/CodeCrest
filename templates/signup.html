<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GlobeIn Sign Up</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
 * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* Background & Centering */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: url("static/images/eba8f2d13c32c02459fa8abb482bc70d.jpg") no-repeat center center fixed;
  background-size: cover;
  color: #ffffff;
  min-height: 100vh;
  display: flex;                
  justify-content: center;      
  align-items: center;          
  flex-direction: column;
  position: relative;
  padding-top: 120px; /* space for navbar */
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.55);
  pointer-events: none;
  z-index: 0;
}

/* Navbar stays fixed on top */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 40px;
  background: rgba(0, 0, 0, 0.3);
  -webkit-backdrop-filter: blur(20px);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(255, 107, 53, 0.2);
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 10;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, #ff6b35, #f39c12, #ff6b35);
  background-size: 200% 100%;
  animation: gradientShift 3s ease-in-out infinite;
}

.logo {
  font-size: 28px;
  font-weight: 800;
  background: linear-gradient(45deg, #ff6b35, #f39c12);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  letter-spacing: 1px;
  transition: all 0.3s ease;
}

.logo:hover {
  transform: scale(1.05);
  filter: drop-shadow(0 0 10px rgba(255, 107, 53, 0.5));
}

.nav-links {
  display: flex;
  gap: 20px;
}

.nav-links a {
  color: #ffffff;
  text-decoration: none;
  font-weight: 600;
  padding: 12px 20px;
  border-radius: 25px;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  background: rgba(255, 255, 255, 0.1);
  -webkit-backdrop-filter: blur(10px);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  position: relative;
  overflow: hidden;
}

.nav-links a::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.2), transparent);
  transition: left 0.5s ease;
}

.nav-links a:hover::before {
  left: 100%;
}

.nav-links a:hover {
  background: rgba(255, 107, 53, 0.2);
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
  border-color: rgba(255, 107, 53, 0.4);
}

/* ✅ Single, centered form-wrapper */
.form-wrapper {
  z-index: 2;
  width: 100%;
  max-width: 900px;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 25px;
  -webkit-backdrop-filter: blur(25px);
  backdrop-filter: blur(25px);
  box-shadow: 0 15px 40px rgba(0,0,0,0.7);
  padding: 50px 60px;
  position: relative;
  margin: 50px 0;
  border: 1px solid rgba(255, 107, 53, 0.2);
  overflow: hidden;
  min-height: 700px;
  transition: all 0.3s ease;
}

.form-wrapper::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #ff6b35, #f39c12);
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.6s ease;
}

.form-wrapper:hover::before {
  transform: scaleX(1);
}

.form-wrapper::after {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255, 107, 53, 0.05) 0%, transparent 70%);
  animation: pulse 5s ease-in-out infinite;
  pointer-events: none;
}

/* Progress bar */
.progressbar {
  display: flex;
  justify-content: space-between;
  list-style: none;
  margin: 20px auto 30px;
  padding: 0;
  max-width: 700px;
  position: relative;
}

.progressbar::before {
  content: '';
  position: absolute;
  top: 17px;
  left: 17px;
  right: 17px;
  height: 4px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 2px;
  z-index: 1;
}

.progressbar li {
  flex: 1;
  text-align: center;
  color: white;
  position: relative;
  font-weight: 600;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  z-index: 2;
}

.progressbar li:hover {
  transform: translateY(-2px);
}

.progressbar li::before {
  content: attr(data-step);
  display: inline-block;
  width: 40px;
  height: 40px;
  line-height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.6);
  font-weight: bold;
  margin-bottom: 8px;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  border: 2px solid rgba(255, 255, 255, 0.2);
  position: relative;
  z-index: 3;
}

.progressbar li.active::before {
  background: linear-gradient(135deg, #ff8800, #ffbb33);
  color: #000;
  transform: scale(1.15);
  box-shadow: 0 6px 20px rgba(255, 136, 0, 0.4);
  border-color: rgba(255, 136, 0, 0.5);
  animation: pulseGlow 2s ease-in-out infinite;
}

.progressbar li.completed::before {
  background: linear-gradient(135deg, #4CAF50, #66BB6A);
  content: "✓";
  color: #fff;
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
  border-color: rgba(76, 175, 80, 0.5);
  animation: successPulse 0.6s ease-out;
}
.progressbar li.error::before {
  content: "⚠";
  background: linear-gradient(135deg, #ff5555, #ff7777);
  color: #fff;
  font-size: 18px;
  transform: scale(1.15);
  box-shadow: 0 6px 20px rgba(255, 85, 85, 0.4);
  border-color: rgba(255, 85, 85, 0.5);
  animation: errorShake 0.5s ease-in-out;
}

.progressbar li::after {
  content: '';
  position: absolute;
  top: 19px;
  left: 50%;
  width: 0%;
  height: 4px;
  background: linear-gradient(90deg, #ff8800, #ffbb33);
  border-radius: 2px;
  z-index: 2;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateX(-50%);
}

.progressbar li:first-child::after { display: none; }

.progressbar li.completed::after {
  width: 100%;
  background: linear-gradient(90deg, #4CAF50, #66BB6A);
}

.progressbar li.active::after {
  width: 50%;
}

/* Animations */
@keyframes pulseGlow {
  0%, 100% { 
    box-shadow: 0 6px 20px rgba(255, 136, 0, 0.4);
  }
  50% { 
    box-shadow: 0 8px 25px rgba(255, 136, 0, 0.6);
  }
}

@keyframes successPulse {
  0% { transform: scale(1.1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1.1); }
}

@keyframes errorShake {
  0%, 100% { transform: scale(1.15) translateX(0); }
  25% { transform: scale(1.15) translateX(-3px); }
  75% { transform: scale(1.15) translateX(3px); }
}

/* Step labels */
.progressbar li span {
  display: block;
  font-size: 14px;
  margin-top: 5px;
  opacity: 0.8;
  transition: all 0.3s ease;
}

.progressbar li.active span {
  opacity: 1;
  color: #ffbb33;
  font-weight: 700;
}

.progressbar li.completed span {
  opacity: 1;
  color: #66BB6A;
}
.form-step { 
  display: none; 
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  opacity: 0;
  transform: translateY(20px);
}

.form-step.active { 
  display: block; 
  animation: fadeInSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes fadeInSlide {
  from { 
    opacity: 0; 
    transform: translateY(20px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

input, select {
  width: 100%;
  padding: 15px 18px;
  margin: 10px 0 20px;
  border-radius: 12px;
  border: 2px solid rgba(255,255,255,0.2);
  outline: none;
  background: rgba(255,255,255,0.1);
  color: #fff;
  font-size: 16px;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  -webkit-backdrop-filter: blur(10px);
  backdrop-filter: blur(10px);
}

input::placeholder, select {
  color: rgba(255,255,255,0.8);
}

input:focus, select:focus {
  background: rgba(255,255,255,0.15);
  box-shadow: 0 0 20px rgba(255, 136, 0, 0.5);
  transform: scale(1.02);
  border-color: #ff8800;
}

legend {
  color: #ff8800;
  font-weight: 600;
  margin-bottom: 10px;
}

fieldset {
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 10px;
  padding: 15px 20px;
  margin-bottom: 20px;
}

.error {
  color: #ff5555;
  font-size: 13px;
  height: 14px;
  margin-top: -12px;
  margin-bottom: 8px;
  display: block;
}

.btn {
  background: linear-gradient(135deg, #ff8800, #ffbb33);
  border: none;
  padding: 15px 35px;
  border-radius: 50px;
  color: #000;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  margin: 15px 8px 0;
  position: relative;
  overflow: hidden;
  box-shadow: 0 6px 20px rgba(255, 136, 0, 0.4);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-size: 16px;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.btn:hover::before {
  left: 100%;
}

.btn:hover {
  transform: scale(1.05) translateY(-3px);
  opacity: 0.9;
  box-shadow: 0 10px 30px rgba(255, 136, 0, 0.5);
}

.btn:active {
  transform: scale(0.98) translateY(0);
}

h3 {
  color: #ffbb33;
  margin-bottom: 15px;
}

#reviewSection {
  line-height: 1.6;
  background: rgba(255,255,255,0.08);
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
}


@media (max-width: 768px) {
  .form-wrapper { padding: 25px; }
  .progressbar li { font-size: 13px; }
}
select {
  color: #fff; 
  background: rgba(255, 255, 255, 0.15);
  border: none;
  border-radius: 10px;
  padding: 12px 14px;
  outline: none;
  font-size: 15px;
  appearance: none; 
}

select option {
  background: #333;      
  color: #fff;           
}

/* On focus */
select:focus {
  background: rgba(255, 255, 255, 0.25);
  box-shadow: 0 0 8px #ff8800;
}


select option[disabled] {
  color: rgba(255, 255, 255, 0.6);
}


.floating-element {
  position: fixed;
  width: 6px;
  height: 6px;
  background: rgba(255, 107, 53, 0.4);
  border-radius: 50%;
  animation: float 8s ease-in-out infinite;
  box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
  pointer-events: none;
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); }
  33% { transform: translateY(-15px) rotate(120deg) scale(1.2); }
  66% { transform: translateY(8px) rotate(240deg) scale(0.8); }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 0.5; }
  50% { transform: scale(1.1); opacity: 0.8; }
}

.floating-element:nth-child(1) { top: 20%; left: 10%; animation-delay: 0s; }
.floating-element:nth-child(2) { top: 60%; left: 20%; animation-delay: 2s; }
.floating-element:nth-child(3) { top: 30%; right: 15%; animation-delay: 4s; }
.floating-element:nth-child(4) { bottom: 40%; right: 25%; animation-delay: 1s; }
.floating-element:nth-child(5) { bottom: 20%; left: 30%; animation-delay: 3s; }


    </style>
  </head>
  <body>

<div class="floating-element"></div>
<div class="floating-element"></div>
<div class="floating-element"></div>
<div class="floating-element"></div>
<div class="floating-element"></div>


  <header class="header">
    <div class="logo">GlobeIn</div>
    <nav class="nav-links">
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('signin') }}">Login</a>
    </nav>
  </header>

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages">
        {% for category, message in messages %}
          <div class="flash-message flash-{{ category }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
      <style>
        /* Flash Messages Styles */
        .flash-messages {
          position: fixed;
          top: 100px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 1000;
          max-width: 500px;
        }
        
        .flash-message {
          color: white;
          padding: 15px 20px;
          margin: 10px 0;
          border-radius: 10px;
          -webkit-backdrop-filter: blur(10px);
          backdrop-filter: blur(10px);
          box-shadow: 0 4px 15px rgba(0,0,0,0.3);
          animation: slideInDown 0.5s ease-out;
        }
        
        .flash-error {
          background: rgba(255, 85, 85, 0.9);
        }
        
        .flash-success {
          background: rgba(76, 175, 80, 0.9);
        }
        
        .flash-info {
          background: rgba(33, 150, 243, 0.9);
        }
        
        @keyframes slideInDown {
          from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
          to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
      </style>
    {% endif %}
  {% endwith %}

  <ul class="progressbar">
  <li class="active" data-step="1"><span>Account Setup</span></li>
  <li data-step="2"><span>Details</span></li>
  <li data-step="3"><span>Review & Submit</span></li>
</ul>

<div class="form-wrapper">
<form id="registrationForm">


  <div class="form-step active" id="step1">
    <h3>Account Setup</h3>
    <input type="text" id="fullname" name="fullname" placeholder="Full Name" required>
    <span class="error" id="fullnameError"></span>

    <input type="text" id="username" name="username" placeholder="Username" required>
    <span class="error" id="usernameError"></span>

    <input type="email" id="email" name="email" placeholder="Email" required>
    <span class="error" id="emailError"></span>

    <input type="tel" id="phone" name="phone" placeholder="Phone" required>
    <span class="error" id="phoneError"></span>

    <input type="password" id="password" name="password" placeholder="Password" required>
    <span class="error" id="passwordError"></span>

    <select id="role" name="role" onchange="roleChanged()" required aria-label="Select your role">
  <option value="">Select Role</option>
  <option value="buyer">Buyer</option>
  <option value="supplier">Supplier / MSME</option>
</select>
    <span class="error" id="roleError"></span>

    <button type="button" class="btn" onclick="nextStep(2)">Next</button>
  </div>
 
  <div class="form-step" id="step2">

    
    <div id="supplierFields">
      <h3>Business Details (Supplier / MSME)</h3>
      <fieldset>
        <legend>Government Identifiers</legend>
        <input type="text" id="registrationNumber" name="registrationNumber" placeholder="Company Registration Number" required>
        <span class="error" id="registrationNumberError"></span>
        <input type="text" id="supplierCrn" name="supplierCrn" placeholder="CRN (Company Registration Number)" required>
        <span class="error" id="supplierCrnError"></span>
      </fieldset>

      <fieldset>
        <legend>Business & Address</legend>
        <input type="text" id="companyName" name="companyName" placeholder="Business / Company Name" required>
        <span class="error" id="companyNameError"></span>

        <select id="businessType" name="typeofbusiness" required aria-label="Select type of business">
          <option value="">Type of Business</option>
          <option value="Proprietorship">Proprietorship</option>
          <option value="Partnership">Partnership</option>
          <option value="LLP">LLP</option>
          <option value="Pvt Ltd">Private Limited</option>
          <option value="Public Ltd">Public Limited</option>
        </select>
        <span class="error" id="businessTypeError"></span>

        <select id="industry" name="industry" required aria-label="Select industry or sector">
          <option value="">Industry / Sector</option>
          <option value="Manufacturing">Manufacturing</option>
          <option value="Services">Services</option>
          <option value="Trading">Trading</option>
          <option value="IT/Software">IT / Software</option>
          <option value="Other">Other</option>
        </select>
        <span class="error" id="industryError"></span>

        <input type="text" id="website" name="website" placeholder="Website (optional)">
        <span class="error" id="websiteError"></span>

        <select id="state" name="state" required aria-label="Select state">
          <option value="">Select State</option>
          <option>Andhra Pradesh</option>
<option>Arunachal Pradesh</option>
<option>Assam</option>
<option>Bihar</option>
<option>Chhattisgarh</option>
<option>Goa</option>
<option>Gujarat</option>
<option>Haryana</option>
<option>Himachal Pradesh</option>
<option>Jharkhand</option>
<option>Karnataka</option>
<option>Kerala</option>
<option>Madhya Pradesh</option>
<option>Maharashtra</option>
<option>Manipur</option>
<option>Meghalaya</option>
<option>Mizoram</option>
<option>Nagaland</option>
<option>Odisha</option>
<option>Punjab</option>
<option>Rajasthan</option>
<option>Sikkim</option>
<option>Tamil Nadu</option>
<option>Telangana</option>
<option>Tripura</option>
<option>Uttar Pradesh</option>
<option>Uttarakhand</option>
<option>West Bengal</option>
        </select>
        <span class="error" id="stateError"></span>

        <input type="text" id="district" name="district" placeholder="District" required>
        <span class="error" id="districtError"></span>

        <input type="text" id="city" name="city" placeholder="City / Town" required>
        <span class="error" id="cityError"></span>

        <input type="text" id="pincode" name="pincode" placeholder="Pincode" required>
        <span class="error" id="pincodeError"></span>
      </fieldset>
    </div>
  
    <div id="buyerFields">
      <h3>Buyer Details</h3>
      <input type="text" id="buyerCompany" name="buyerCompany" placeholder="Company / Organization Name " required>
      <span class="error" id="buyerCompanyError"></span>
      <input type="text" id="crn" name="buyerRegistrationNumber" placeholder="Company registration number" required>

      <select id="buyerType" name="buyertype" required aria-label="Select buyer type">
        <option value="">Type of Buyer</option>
        <option value="Individual">Individual</option>
        <option value="Company">Company</option>
        <option value="Government">Government</option>
        <option value="NGO">NGO</option>
        <option value="Retailer">Retailer</option>
        <option value="Wholesaler">Wholesaler</option>
      </select>
      <span class="error" id="buyerTypeError"></span>

      <select id="buyerIndustry" name="buyerIndustry" aria-label="Select buyer industry">
        <option value="">Industry / Sector (optional)</option>
        <option value="Manufacturing">Manufacturing</option>
        <option value="Services">Services</option>
        <option value="Trading">Trading</option>
        <option value="IT/Software">IT / Software</option>
        <option value="Other">Other</option>
      </select>
      <span class="error" id="buyerIndustryError"></span>

      <input type="text" id="buyerWebsite" name="buyerWebsite" placeholder="Website (optional)">
      <span class="error" id="buyerWebsiteError"></span>

      <select id="buyerState" name="buyerState" required aria-label="Select buyer state">
        <option value="">Select State</option>
        <option>Andhra Pradesh</option>
<option>Arunachal Pradesh</option>
<option>Assam</option>
<option>Bihar</option>
<option>Chhattisgarh</option>
<option>Goa</option>
<option>Gujarat</option>
<option>Haryana</option>
<option>Himachal Pradesh</option>
<option>Jharkhand</option>
<option>Karnataka</option>
<option>Kerala</option>
<option>Madhya Pradesh</option>
<option>Maharashtra</option>
<option>Manipur</option>
<option>Meghalaya</option>
<option>Mizoram</option>
<option>Nagaland</option>
<option>Odisha</option>
<option>Punjab</option>
<option>Rajasthan</option>
<option>Sikkim</option>
<option>Tamil Nadu</option>
<option>Telangana</option>
<option>Tripura</option>
<option>Uttar Pradesh</option>
<option>Uttarakhand</option>
<option>West Bengal</option>
      </select>
      <span class="error" id="buyerStateError"></span>

      <input type="text" id="buyerDistrict" name="buyerDistrict" placeholder="District" required>
      <span class="error" id="buyerDistrictError"></span>

      <input type="text" id="buyerCity" name="buyerCity" placeholder="City / Town" required>
      <span class="error" id="buyerCityError" name="buyerCityError"></span>

      <input type="text" id="buyerPincode" name="buyerPincode" placeholder="Pincode" required>
      <span class="error" id="buyerPincodeError"></span>
    </div>

    <button type="button" class="btn" onclick="nextStep(1)">Previous</button>
    <button type="button" class="btn" onclick="nextStep(3)">Next</button>
  </div>

  
  <div class="form-step" id="step3">
    <h3>Review & Submit</h3>
    <div id="reviewSection"></div>
    <label>
      <input type="checkbox" id="declaration"> I hereby declare that the above information is true
    </label>
    <br>
    <span class="error" id="declarationError"></span>
    <button type="button" class="btn" onclick="nextStep(2)">Previous</button>
    <button type="button" id="submitBtn" class="btn" onclick="finalSubmit()">Submit</button>
  </div>

</form>
</div>
  </body>
  <script>
   function roleChanged() {
  const role = document.getElementById('role').value;
  const buyerFields = document.getElementById('buyerFields');
  const supplierFields = document.getElementById('supplierFields');
  
  if (role === 'buyer') {
    buyerFields.style.display = 'block';
    supplierFields.style.display = 'none';
  } else if (role === 'supplier') {
    buyerFields.style.display = 'none';
    supplierFields.style.display = 'block';
  } else {
    buyerFields.style.display = 'none';
    supplierFields.style.display = 'none';
  }
}

let currentStep = 1;
function nextStep(step) {
  console.log(`nextStep called: currentStep=${currentStep}, targetStep=${step}`);
  
  // Only validate when going forward, not backward
  if(step > currentStep) {
    console.log('Going forward - validating current step');
    if(validateStep(currentStep)) {
      console.log('Validation passed - proceeding to next step');
      goToStep(step);
      if(step === 3) fillReview();
    } else {
      console.log('Validation failed - staying on current step');
    }
  } else {
    // Going backward - no validation needed
    console.log('Going backward - no validation needed');
    goToStep(step);
  }
}
function goToStep(step) {
  console.log(`goToStep called: step=${step}`);
  currentStep = step;
  
  
  const currentActiveStep = document.querySelector('.form-step.active');
  const targetStep = document.getElementById('step' + step);
  console.log(`currentActiveStep: ${currentActiveStep ? currentActiveStep.id : 'null'}, targetStep: ${targetStep ? targetStep.id : 'null'}`);
  
  if (currentActiveStep && targetStep) {
    
    currentActiveStep.style.opacity = '0';
    currentActiveStep.style.transform = 'translateY(-20px)';
    
    
    setTimeout(() => {
      
      document.querySelectorAll('.form-step').forEach(div => {
        div.classList.remove('active');
      });
      
      
      targetStep.classList.add('active');
      
      
      setTimeout(() => {
        targetStep.style.opacity = '1';
        targetStep.style.transform = 'translateY(0)';
      }, 50);
      
    }, 200); 
  } else {
    
    document.querySelectorAll('.form-step').forEach(div => {
      div.classList.remove('active');
      div.style.opacity = '0';
      div.style.transform = 'translateY(20px)';
    });
    
    if (targetStep) {
      targetStep.classList.add('active');
      targetStep.style.opacity = '1';
      targetStep.style.transform = 'translateY(0)';
    }
  }

  updateProgressBar();
  
  
  if (step === 2) {
    roleChanged();
  }
}


function updateProgressBar() {
  const steps = document.querySelectorAll('.progressbar li');
  steps.forEach((li, index) => {
    li.classList.remove('active', 'completed', 'error');
    const stepNum = index + 1;

    if (stepNum < currentStep) li.classList.add('completed');
    else if (stepNum === currentStep) li.classList.add('active');

    
    const stepDiv = document.getElementById('step' + stepNum);
    const errors = stepDiv.querySelectorAll('.error');
    let hasError = false;
    errors.forEach(e => {
      if (e.textContent.trim() !== "") hasError = true;
    });
    if (hasError) li.classList.add('error'); 
  });
}


function validateStep(step) {
  let valid = true;
  const currentDiv = document.getElementById('step' + step);
  const role = document.getElementById('role').value;
  
  // Get inputs based on step and role
  let inputsToValidate = [];
  
  if (step === 1) {
    // Step 1: Basic account info
    inputsToValidate = currentDiv.querySelectorAll('input, select');
  } else if (step === 2) {
    // Step 2: Role-specific fields
    if (role === 'supplier') {
      inputsToValidate = currentDiv.querySelectorAll('#supplierFields input, #supplierFields select');
    } else if (role === 'buyer') {
      inputsToValidate = currentDiv.querySelectorAll('#buyerFields input, #buyerFields select');
    } else {
      // No role selected, show error
      valid = false;
      const roleError = document.getElementById('roleError');
      if (roleError) {
        roleError.textContent = "Please select a role first";
      }
    }
    
  } else if (step === 3) {
    // Step 3: Declaration
    inputsToValidate = currentDiv.querySelectorAll('input, select');
  }
  
  console.log(`Validating step ${step}, role: ${role}, inputs found: ${inputsToValidate.length}`);
  
  // Log the field IDs being validated
  const fieldIds = Array.from(inputsToValidate).map(input => input.id);
  console.log('Fields being validated:', fieldIds);

  inputsToValidate.forEach(input => {
    const val = input.value.trim();
    const errorSpan = document.getElementById(input.id + 'Error');
    if (errorSpan) errorSpan.textContent = '';
    input.style.border = '1px solid #ccc';

    // Required fields
    if (input.hasAttribute('required') || input.getAttribute('data-required') === 'true') {
      if (!val) {
        console.log(`Required field empty: ${input.id}`);
        if (errorSpan) errorSpan.textContent = "This field is required";
        input.style.border = '2px solid red';
        valid = false;
      } else {
        console.log(`Required field filled: ${input.id} = "${val}"`);
      }
    }

    if (val) {
      // Phone validation
      if (input.id === 'phone' && !/^\d{10}$/.test(val)) {
        if (errorSpan) errorSpan.textContent = "Phone must be 10 digits";
        input.style.border = '2px solid red';
        valid = false;
      }

      // Password validation
      if (input.id === 'password' && !/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?#&]).{8,}$/.test(val)) {
        if (errorSpan) errorSpan.textContent = "Min 8 chars with upper, lower, number & special char";
        input.style.border = '2px solid red';
        valid = false;
      }

      // Email validation
      if (input.id === 'email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val)) {
        if (errorSpan) errorSpan.textContent = "Enter a valid email address";
        input.style.border = '2px solid red';
        valid = false;
      }

      // Company Registration Number (CIN) validation for supplier
      if (input.id === 'registrationNumber' && val && !/^[UFLP]\d{5}[A-Z]{2}\d{4}[A-Z]{3}\d{6}$/.test(val)) {
        if (errorSpan) errorSpan.textContent = "Invalid registration number format. Use format: U12345AB1234ABC123456";
        input.style.border = '2px solid red';
        valid = false;
      }

      // Buyer Company Registration Number (CIN format)
      if (input.id === 'crn' && val && !/^[UFLP]\d{5}[A-Z]{2}\d{4}[A-Z]{3}\d{6}$/.test(val)) {
        if (errorSpan) errorSpan.textContent = "Invalid registration number format. Use format: U12345AB1234ABC123456";
        input.style.border = '2px solid red';
        valid = false;
      }

      // Pincode validation
      if ((input.id === 'pincode' || input.id === 'buyerPincode') && !/^\d{6}$/.test(val)) {
        if (errorSpan) errorSpan.textContent = "Pincode must be 6 digits";
        input.style.border = '2px solid red';
        valid = false;
      }

      // Website validation (optional)
      if ((input.id === 'website' || input.id === 'buyerWebsite') && val && !/^(https?:\/\/)?([\w\d-]+\.)+[\w]{2,}(\/.*)?$/.test(val)) {
        if (errorSpan) errorSpan.textContent = "Enter a valid website URL";
        input.style.border = '2px solid red';
        valid = false;
      } 
    }
  });

  // Declaration checkbox in step 3
  if (step === 3) {
    const declaration = document.getElementById('declaration');
    const declarationError = document.getElementById('declarationError');
    if (declaration && !declaration.checked) {
      if (declarationError) declarationError.textContent = "You must accept the declaration";
      valid = false;
    } else if (declarationError) {
      declarationError.textContent = "";
    }
  }

  updateProgressBar();
  console.log(`Step ${step} validation result: ${valid}`);
  return valid;
}

function finalSubmit() {
  const totalSteps = document.querySelectorAll('.form-step').length;
  let allValid = true;

  
  for (let i = 1; i <= totalSteps; i++) {
    if (!validateStep(i)) {
      allValid = false;
    }
  }

  
  if (!allValid) {
    alert("⚠️ Please complete all required fields before ticking the declaration!");
    updateProgressBar();
    return;
  }

  
  const decl = document.getElementById('declaration');
  const declError = document.getElementById('declarationError');
  declError.textContent = "";

  if (!decl.checked) {
    alert("You must accept the Declaration!");
    updateProgressBar();
    return;
  }

  alert("✅ Form Submitted Successfully!");
  submitToDatabase();
}


function submitToDatabase() {
  const role = document.getElementById('role').value;
  
  // Base form data
  const formData = {
    fullname: document.getElementById('fullname').value,
    username: document.getElementById('username').value,
    email: document.getElementById('email').value,
    phone: document.getElementById('phone').value,
    password: document.getElementById('password').value,
    role: role
  };

  // Add role-specific data
  if (role === 'supplier') {
    formData.registrationNumber = document.getElementById('registrationNumber').value;
    formData.supplierCrn = document.getElementById('supplierCrn').value;
    formData.companyName = document.getElementById('companyName').value;
    formData.typeofbusiness = document.getElementById('businessType').value;
    formData.industry = document.getElementById('industry').value;
    formData.website = document.getElementById('website').value;
    formData.state = document.getElementById('state').value;
    formData.district = document.getElementById('district').value;
    formData.city = document.getElementById('city').value;
    formData.pincode = document.getElementById('pincode').value;
  } else if (role === 'buyer') {
    formData.buyerCompany = document.getElementById('buyerCompany').value;
    formData.buyerRegistrationNumber = document.getElementById('crn').value;
    formData.buyertype = document.getElementById('buyerType').value;
    formData.buyerIndustry = document.getElementById('buyerIndustry').value;
    formData.buyerWebsite = document.getElementById('buyerWebsite').value;
    formData.buyerState = document.getElementById('buyerState').value;
    formData.buyerDistrict = document.getElementById('buyerDistrict').value;
    formData.buyerCity = document.getElementById('buyerCity').value;
    formData.buyerPincode = document.getElementById('buyerPincode').value;
  }

  console.log("Sending to DB:", formData);
}
document.getElementById('declaration').addEventListener('change', function() {
    const decl = this;
    const totalSteps = document.querySelectorAll('.form-step').length;
    let allValid = true;

    
    for (let i = 1; i <= totalSteps; i++) {
        if (!validateStep(i)) {
            allValid = false;
        }
    }

    if (!allValid) {
        alert("⚠️ You cannot tick the declaration until all required fields are filled!");
        decl.checked = false; 
    }
});
function fillReview() {
    const reviewDiv = document.getElementById('reviewSection');
    reviewDiv.innerHTML = ''; 

    const role = document.getElementById('role').value;

    
    reviewDiv.innerHTML += `<h4>Account Info:</h4>
        <p><strong>Full Name:</strong> ${document.getElementById('fullname').value}</p>
        <p><strong>Username:</strong> ${document.getElementById('username').value}</p>
        <p><strong>Email:</strong> ${document.getElementById('email').value}</p>
        <p><strong>Phone:</strong> ${document.getElementById('phone').value}</p>
        <p><strong>Role:</strong> ${role}</p>`;

    
    if (role === 'supplier') {
        reviewDiv.innerHTML += `<h4>Business Details:</h4>
            <p><strong>Company Name:</strong> ${document.getElementById('companyName').value}</p>
            <p><strong>Registration Number:</strong> ${document.getElementById('registrationNumber').value}</p>
            <p><strong>CRN:</strong> ${document.getElementById('supplierCrn').value}</p>
            <p><strong>Business Type:</strong> ${document.getElementById('businessType').value}</p>
            <p><strong>Industry:</strong> ${document.getElementById('industry').value}</p>
            <p><strong>Website:</strong> ${document.getElementById('website').value}</p>
            <p><strong>Location:</strong> ${document.getElementById('city').value}, ${document.getElementById('district').value}, ${document.getElementById('state').value} - ${document.getElementById('pincode').value}</p>`;
    } else if (role === 'buyer') {
        reviewDiv.innerHTML += `<h4>Buyer Details:</h4>
            <p><strong>Company / Organization:</strong> ${document.getElementById('buyerCompany').value}</p>
            <p><strong>CRN:</strong> ${document.getElementById('crn').value}</p>
            <p><strong>Buyer Type:</strong> ${document.getElementById('buyerType').value}</p>
            <p><strong>Industry:</strong> ${document.getElementById('buyerIndustry').value}</p>
            <p><strong>Website:</strong> ${document.getElementById('buyerWebsite').value}</p>
            <p><strong>Location:</strong> ${document.getElementById('buyerCity').value}, ${document.getElementById('buyerDistrict').value}, ${document.getElementById('buyerState').value} - ${document.getElementById('buyerPincode').value}</p>`;
    }
}


function finalSubmit() {
    if (!document.getElementById("declaration").checked) {
        document.getElementById("declarationError").innerText = "Please accept the declaration.";
        return;
    }

    // Submit the form to Flask backend
    const form = document.getElementById("registrationForm");
    form.method = "POST";
    form.action = "/signup";  
    form.submit();
}


document.addEventListener('DOMContentLoaded', function() {
    
    roleChanged(); 
    
    
    window.addEventListener('mousemove', function(e) {
        const floatingElements = document.querySelectorAll('.floating-element');
        const mouseX = e.clientX / window.innerWidth;
        const mouseY = e.clientY / window.innerHeight;

        floatingElements.forEach((element, index) => {
            const speed = (index + 1) * 0.3;
            const x = (mouseX - 0.5) * speed * 5;
            const y = (mouseY - 0.5) * speed * 5;
            element.style.transform += ` translate(${x}px, ${y}px)`;
        });
    });

    
    const inputs = document.querySelectorAll('input, select');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.style.transform = 'scale(1.02)';
            this.parentElement.style.transform = 'scale(1.01)';
        });
        
        input.addEventListener('blur', function() {
            this.style.transform = 'scale(1)';
            this.parentElement.style.transform = 'scale(1)';
        });
    });

    
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(button => {
        button.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
        });
    });

    
    const formSteps = document.querySelectorAll('.form-step');
    formSteps.forEach((step, index) => {
        if (index === 0) {
            
            step.style.opacity = '1';
            step.style.transform = 'translateY(0)';
        } else {
        
            step.style.opacity = '0';
            step.style.transform = 'translateY(20px)';
        }
    });
});

</script>
</html>